<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Balances</title>
  </head>
  <body>
    <h1>Account Balances</h1>
    <button id="refreshBtn">Refresh</button>
    <table id="balTbl" border="1" style="margin-top:8px">
      <thead><tr><th>Account</th><th>Type</th><th>Available</th><th>Ledger</th><th>As Of</th></tr></thead>
      <tbody></tbody>
    </table>

    <p style="margin-top:12px">
      Note: Use your Admin flow to populate data; this page only reads from <code>/api/balances</code>.
    </p>

    <script>
    async function loadBalances() {
      const tbody = document.querySelector('#balTbl tbody');
      tbody.innerHTML = '<tr><td colspan="5">Loadingâ€¦</td></tr>';
      try {
        const r = await fetch('/api/balances', { cache: 'no-store' });
        if (r.status === 204) { tbody.innerHTML = '<tr><td colspan="5">No data yet</td></tr>'; return; }
        if (!r.ok) { tbody.innerHTML = `<tr><td colspan="5">API error ${r.status}</td></tr>`; return; }
        const data = await r.json();
        tbody.innerHTML = data.map(x => `
          <tr>
            <td>${x.name ?? ''}</td>
            <td>${x.type ?? ''}</td>
            <td>${x.available ?? ''}</td>
            <td>${x.ledger ?? ''}</td>
            <td>${x.as_of ? new Date(x.as_of).toLocaleString() : ''}</td>
          </tr>`).join('');
      } catch (e) {
        tbody.innerHTML = `<tr><td colspan="5">Network error</td></tr>`;
      }
    }
    document.getElementById('refreshBtn').addEventListener('click', loadBalances);
    window.addEventListener('DOMContentLoaded', loadBalances);
    </script>
  </body>
  </html>
